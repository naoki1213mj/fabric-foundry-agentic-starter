# ARCHITECTURE.md - æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

> **æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ5æ—¥ - **Azure å®Ÿæ©Ÿç’°å¢ƒã‚’ç¢ºèªã—ã¦**æ›´æ–°

## Azure å®Ÿæ©Ÿç’°å¢ƒã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | ãƒªã‚½ãƒ¼ã‚¹å | å€¤ï¼ˆå®Ÿæ©Ÿç¢ºèª 2026/2/5ï¼‰ |
| -------- | ---------- | -------------- |
| **Resource Group** | - | `rg-agent-unified-data-acce-eastus-001` |
| **App Service (API)** | `api-daj6dri4yf3k3z` | Linux Container @ East US |
| **App Service (Frontend)** | `app-daj6dri4yf3k3z` | Linux Container @ East US |
| **Container Registry** | `crda672axowukix3.azurecr.io` | Premium @ East US |
| **Azure AI Services** | `aisa-daj6dri4yf3k3z` | AIServices @ East US |
| **AI Foundry Project** | `aifp-daj6dri4yf3k3z` | East US |
| **Azure AI Search** | `search-sp-rag-australiaeast-001` | Standard @ Australia East |
| **API Management** | `apim-daj6dri4yf3k3z` | Consumption @ Australia East |
| **API Center** | `apic-daj6dri4yf3k3z` | Free @ Australia East |
| **MCP Server** | `func-mcp-daj6dri4yf3k3z` | Azure Functions Python 3.12 |
| **LLM Model** | gpt-5 | 500K TPM |
| **LLM Model (Mini)** | gpt-4o-mini | 30K TPM |
| **Embedding** | text-embedding-3-large | 500K TPM |
| **Bing Connection** | `bingglobal00149elbd` | Web Search |

---

## å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    CLIENT LAYER                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Azure App Service (app-daj6dri4yf3k3z)                                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ React + TypeScript Frontend                                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Natural Language Query Interface                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Agent Mode Selector (sql_only / multi_tool / handoff / magentic)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Doc Search Reasoning Effort (minimal / low / medium)                             â”‚  â”‚
â”‚  â”‚  â””â”€ Built-in Auth (Entra ID EasyAuth)                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    API LAYER                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Azure App Service (api-daj6dri4yf3k3z) - Python FastAPI                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/chat - Main chat endpoint (streaming SSE)                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ /api/conversations - Conversation history                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ /health - Health check                                                            â”‚  â”‚
â”‚  â”‚  â””â”€ Agent Orchestration (Microsoft Agent Framework)                                  â”‚  â”‚
â”‚  â”‚      â”œâ”€ sql_only mode   â†’ AzureOpenAIResponsesClient + SQL Tool                      â”‚  â”‚
â”‚  â”‚      â”œâ”€ multi_tool mode â†’ AzureOpenAIResponsesClient + All Tools                     â”‚  â”‚
â”‚  â”‚      â”œâ”€ handoff mode    â†’ AzureOpenAIChatClient + HandoffBuilder                     â”‚  â”‚
â”‚  â”‚      â””â”€ magentic mode   â†’ AzureOpenAIChatClient + MagenticBuilder                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              INTEGRATION LAYER (AI Gateway)                                  â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  API Management                 â”‚  â”‚  API Center                     â”‚                   â”‚
â”‚  â”‚  (apim-daj6dri4yf3k3z)          â”‚  â”‚  (apic-daj6dri4yf3k3z)          â”‚                   â”‚
â”‚  â”‚  Consumption SKU                â”‚  â”‚  Free SKU                       â”‚                   â”‚
â”‚  â”‚                                 â”‚  â”‚                                 â”‚                   â”‚
â”‚  â”‚  APIs:                          â”‚  â”‚  Tool Catalog:                  â”‚                   â”‚
â”‚  â”‚  â”œâ”€ /openai                     â”‚  â”‚  â”œâ”€ Business Analytics MCP     â”‚                   â”‚
â”‚  â”‚  â”‚   â†’ Azure OpenAI (legacy)    â”‚  â”‚  â”‚   â”œâ”€ YoY Analysis           â”‚                   â”‚
â”‚  â”‚  â”œâ”€ /foundry-openai/openai/v1/  â”‚  â”‚  â”‚   â”œâ”€ RFM Segmentation       â”‚                   â”‚
â”‚  â”‚  â”‚   â†’ Foundry AI Services â˜…    â”‚  â”‚  â”‚   â”œâ”€ åœ¨åº«åˆ†æ               â”‚                   â”‚
â”‚  â”‚  â”œâ”€ /mcp                        â”‚  â”‚  â”‚   â”œâ”€ å­£ç¯€ãƒˆãƒ¬ãƒ³ãƒ‰           â”‚                   â”‚
â”‚  â”‚  â”‚   â†’ MCP Server               â”‚  â”‚  â”‚   â””â”€ åœ°åŸŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹     â”‚                   â”‚
â”‚  â”‚  â””â”€ /foundry-agents             â”‚  â”‚  â””â”€ Azure OpenAI API           â”‚                   â”‚
â”‚  â”‚      â†’ Foundry Agent Service    â”‚  â”‚                                 â”‚                   â”‚
â”‚  â”‚                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”‚  Features:                      â”‚                                                        â”‚
â”‚  â”‚  â”œâ”€ Circuit Breaker (30s)       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  â”œâ”€ Token Metrics Headers       â”‚  â”‚  MCP Server                     â”‚                   â”‚
â”‚  â”‚  â”œâ”€ Managed Identity Auth       â”‚  â”‚  (func-mcp-daj6dri4yf3k3z)      â”‚                   â”‚
â”‚  â”‚  â””â”€ Latency Measurement         â”‚  â”‚  Azure Functions Python 3.12   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                 â”‚                   â”‚
â”‚                                       â”‚  Endpoints:                     â”‚                   â”‚
â”‚                                       â”‚  â”œâ”€ /api/mcp (JSON-RPC 2.0)    â”‚                   â”‚
â”‚                                       â”‚  â””â”€ /api/tools/{tool_name}     â”‚                   â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    AI LAYER                                                  â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Microsoft Foundry (aisa-daj6dri4yf3k3z / aifp-daj6dri4yf3k3z)                      â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Azure OpenAI       â”‚  â”‚  Foundry Guardrails â”‚  â”‚  Foundry IQ (Agentic RAG)   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Models:            â”‚  â”‚  â”œâ”€ Task Adherence  â”‚  â”‚  Knowledge Base:            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ gpt-5 (500K)    â”‚  â”‚  â”œâ”€ Prompt Shields  â”‚  â”‚  â””â”€ product-specs-kb        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ gpt-4o-mini     â”‚  â”‚  â”œâ”€ Spotlighting    â”‚  â”‚                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   (30K)          â”‚  â”‚  â””â”€ Groundedness    â”‚  â”‚  Reasoning Effort:          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ text-embedding  â”‚  â”‚      Detection      â”‚  â”‚  â”œâ”€ minimal (ç›´æ¥æ¤œç´¢)      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚      -3-large       â”‚  â”‚                     â”‚  â”‚  â”œâ”€ low (ã‚·ãƒ³ã‚°ãƒ«ãƒ‘ã‚¹)      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚      (500K)         â”‚  â”‚                     â”‚  â”‚  â””â”€ medium (åå¾©æ¤œç´¢)       â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  Bing Grounding     â”‚  â”‚  Project Connections                                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                                                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Connection:        â”‚  â”‚  â”œâ”€ bingglobal00149elbd (Bing Search)               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  bingglobal00149elbdâ”‚  â”‚  â”œâ”€ AI Search Connection                            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚  â””â”€ Fabric SQL Connection                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Tool Pattern:      â”‚  â”‚                                                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  BingGroundingAgent â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚  â”‚  Tool               â”‚                                                            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Azure AI Search (search-sp-rag-australiaeast-001) - Standard SKU                   â”‚    â”‚
â”‚  â”‚  â”œâ”€ Index: product-specs-sharepoint-ks-index                                        â”‚    â”‚
â”‚  â”‚  â””â”€ API Version: 2025-11-01-preview                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    DATA LAYER                                                â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Microsoft Fabric (capagentunifieddata001) - F4 Capacity                            â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  SQL Database in Fabric                                                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  retail_sqldatabase_daj6dri4yf3k3z-c9a4f960-6dfe-4e75-8ef6-ac9ef3f35e44    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Business Data Tables:          History Tables:                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ customers                   â”œâ”€ hst_conversations                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ products                    â””â”€ hst_conversation_messages                â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ orders                                                                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ order_items                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ inventory                                                               â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  OneLake (Medallion Architecture)                                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ Bronze: Raw Data                                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ Silver: Validated/Cleansed                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Gold: Business-Ready                                                    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ„ãƒ¼ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AGENT TOOLS ARCHITECTURE                                        â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Agent Framework Tool Registry                                                      â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  @ai_function decorated tools:                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚  â”‚  â”‚  SQL Tool           â”‚  â”‚  Doc Tool           â”‚  â”‚  Web Tool           â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  sql_agent.py       â”‚  â”‚  agentic_retrieval  â”‚  â”‚  web_agent.py       â”‚         â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚  _tool.py           â”‚  â”‚                     â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  execute_sql_query  â”‚  â”‚                     â”‚  â”‚  search_web         â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  ()                 â”‚  â”‚  search_documents() â”‚  â”‚  ()                 â”‚         â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  Backend:           â”‚  â”‚  Backend:           â”‚  â”‚  Backend:           â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  Fabric SQL DB      â”‚  â”‚  Foundry IQ         â”‚  â”‚  Bing Grounding     â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  (pyodbc)           â”‚  â”‚  (Agentic RAG)      â”‚  â”‚  AgentTool          â”‚         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â”‚                                                                                      â”‚    â”‚
â”‚  â”‚  MCP Tools (via APIM Gateway):                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  MCP Server (func-mcp-daj6dri4yf3k3z)                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ analyze_yoy_performance()     - å‰å¹´æ¯”åˆ†æ                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ analyze_rfm_segments()        - é¡§å®¢ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (RFM)            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ analyze_inventory()           - åœ¨åº«æœ€é©åŒ–åˆ†æ                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ analyze_seasonal_trends()     - å­£ç¯€ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ analyze_regional_performance()- åœ°åŸŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Protocol: JSON-RPC 2.0 over HTTP                                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Endpoint: https://apim-*/mcp â†’ https://func-mcp-*/api/mcp                  â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Mermaid å›³

```mermaid
graph TB
    subgraph Client["ğŸ–¥ï¸ Client Layer"]
        WEB["App Service<br/>app-daj6dri4yf3k3z<br/>React Frontend"]
    end

    subgraph API["âš™ï¸ API Layer"]
        ACA["App Service<br/>api-daj6dri4yf3k3z<br/>Python FastAPI"]
        MAF["Microsoft Agent Framework<br/>ResponsesClient / ChatClient"]
    end

    subgraph Integration["ğŸ”Œ Integration Layer"]
        APIM["API Management<br/>apim-daj6dri4yf3k3z<br/>AI Gateway"]
        APIC["API Center<br/>apic-daj6dri4yf3k3z<br/>Tool Catalog"]
        MCP["MCP Server<br/>func-mcp-daj6dri4yf3k3z<br/>Business Analytics"]
    end

    subgraph AI["ğŸ¤– AI Layer"]
        FAS["Foundry Project<br/>aifp-daj6dri4yf3k3z"]
        OAI["Azure OpenAI<br/>gpt-5 / gpt-4o-mini"]
        FIQ["Foundry IQ<br/>Agentic Retrieval"]
        BING["Bing Grounding<br/>bingglobal00149elbd"]
        FG["Foundry Guardrails"]
        SEARCH["Azure AI Search<br/>search-sp-rag-*"]
    end

    subgraph Data["ğŸ’¾ Data Layer"]
        FABRIC["Microsoft Fabric<br/>F4 Capacity"]
        SQLDB["SQL Database in Fabric<br/>retail_sqldatabase_*"]
        ONELAKE["OneLake<br/>Medallion Architecture"]
    end

    WEB -->|HTTPS| ACA
    ACA --> MAF
    MAF -->|/foundry-openai| APIM
    APIM --> OAI
    MAF --> FAS
    FAS --> FG
    FAS --> OAI
    MAF -->|SQL Query| SQLDB
    MAF -->|Agentic RAG| FIQ
    FIQ --> SEARCH
    MAF -->|Web Search| BING
    MAF -->|/mcp| APIM
    APIM --> MCP
    APIC -.->|Discovery| MCP
    SQLDB --> ONELAKE
    ONELAKE --> FABRIC
```

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AGENT MODES ARCHITECTURE                                        â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Mode Selection (Frontend â†’ /api/chat?agent_mode=xxx)                                â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  sql_only       â”‚  â”‚  multi_tool â˜…   â”‚  â”‚  handoff        â”‚  â”‚  magentic       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  âš¡ æœ€é€Ÿ        â”‚  â”‚  ğŸ”¥ æ¨å¥¨        â”‚  â”‚  æ™®é€š           â”‚  â”‚  é…ã„           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  SQLå°‚ç”¨        â”‚  â”‚  å…¨ãƒ„ãƒ¼ãƒ«       â”‚  â”‚  å°‚é–€å®¶å§”è­²     â”‚  â”‚  ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚  çµ±åˆ           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Client:        â”‚  â”‚  Client:        â”‚  â”‚  Client:        â”‚  â”‚  Client:        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Responses âœ“    â”‚  â”‚  Responses âœ“    â”‚  â”‚  Chat (SDKåˆ¶ç´„) â”‚  â”‚  Chat (SDKåˆ¶ç´„) â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Tools:         â”‚  â”‚  Tools:         â”‚  â”‚  Tools:         â”‚  â”‚  Tools:         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ SQL         â”‚  â”‚  â”œâ”€ SQL         â”‚  â”‚  Specialists:   â”‚  â”‚  Specialists:   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â”œâ”€ Doc         â”‚  â”‚  â”œâ”€ SQL Agent   â”‚  â”‚  â”œâ”€ SQL Agent   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â”œâ”€ Web         â”‚  â”‚  â”œâ”€ Doc Agent   â”‚  â”‚  â”œâ”€ Doc Agent   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â””â”€ MCP(5)      â”‚  â”‚  â””â”€ Web Agent   â”‚  â”‚  â””â”€ Web Agent   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  Note: handoff/magentic ã¯ HandoffBuilder/MagenticBuilder SDK ãŒ                     â”‚   â”‚
â”‚  â”‚        AzureOpenAIChatClient ã‚’è¦æ±‚ã™ã‚‹ãŸã‚ ChatClient ã‚’ç¶­æŒ                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¢ãƒ¼ãƒ‰é¸æŠã‚¬ã‚¤ãƒ‰

| ãƒ¢ãƒ¼ãƒ‰ | Client | é€Ÿåº¦ | ç”¨é€” | ç‰¹å¾´ |
|--------|--------|------|------|------|
| `sql_only` | ResponsesClient | âš¡æœ€é€Ÿ | å˜ç´”ãªSQLã‚¯ã‚¨ãƒª | SQLãƒ„ãƒ¼ãƒ«ã®ã¿ |
| `multi_tool` | ResponsesClient | ğŸ”¥é«˜é€Ÿ | **æ¨å¥¨** - æ±ç”¨ | LLMãŒæœ€é©ãƒ„ãƒ¼ãƒ«é¸æŠ |
| `handoff` | ChatClient | æ™®é€š | å°‚é–€å®¶å§”è­² | çµæœã¯çµ±åˆã•ã‚Œãªã„ |
| `magentic` | ChatClient | é…ã„ | è¤‡é›‘ãªåˆ†æ | ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒçµæœçµ±åˆ |

---

## API Management (AI Gateway) è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API MANAGEMENT CONFIGURATION                                    â”‚
â”‚                              apim-daj6dri4yf3k3z (Consumption SKU)                          â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Registered APIs                                                                     â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  /openai (Legacy)                                                           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Backend: https://aisa-daj6dri4yf3k3z.openai.azure.com                      â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  /foundry-openai/openai/v1/ â˜… Primary                                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Backend: https://aisa-daj6dri4yf3k3z.services.ai.azure.com                 â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â†’ Used by AzureOpenAIResponsesClient                                       â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  /mcp                                                                       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Backend: https://func-mcp-daj6dri4yf3k3z.azurewebsites.net                 â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  /foundry-agents                                                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Backend: Foundry Agent Service                                             â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  AI Gateway Features                                                                 â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ Circuit Breaker: 429/500-599 errors â†’ 30s trip duration                         â”‚   â”‚
â”‚  â”‚  â”œâ”€ Token Metrics: x-openai-{prompt,completion,total}-tokens headers                â”‚   â”‚
â”‚  â”‚  â”œâ”€ Latency: x-gateway-latency-ms header                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€ Authentication: Managed Identity (DefaultAzureCredential)                       â”‚   â”‚
â”‚  â”‚  â””â”€ Note: llm-emit-token-metric not supported on Consumption SKU                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

```
src/api/python/prompts/
â”œâ”€â”€ __init__.py          # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ sql_agent.py         # SQL_AGENT_PROMPT
â”œâ”€â”€ web_agent.py         # WEB_AGENT_PROMPT
â”œâ”€â”€ doc_agent.py         # DOC_AGENT_PROMPT
â”œâ”€â”€ manager_agent.py     # MANAGER_AGENT_PROMPT
â”œâ”€â”€ unified_agent.py     # UNIFIED_AGENT_PROMPT
â””â”€â”€ triage_agent.py      # TRIAGE_AGENT_PROMPT
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤æ§‹æˆ

### GitHub Actionsï¼ˆç¾åœ¨ã®æ–¹å¼ï¼‰

```
git push â†’ GitHub Actions â†’ Docker Build â†’ ACR Push â†’ App Service Restart
```

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒˆãƒªã‚¬ãƒ¼ |
|---------------|---------|
| Frontend | `src/App/**` å¤‰æ›´æ™‚ |
| API | `src/api/python/**` å¤‰æ›´æ™‚ |
| Agents | `infra/scripts/agent_scripts/agents/**` å¤‰æ›´æ™‚ |

### azd upï¼ˆåˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”¨ï¼‰

```bash
azd up
â”œâ”€â”€ provision (Bicep)
â”‚   â”œâ”€â”€ Resource Group
â”‚   â”œâ”€â”€ Container Registry
â”‚   â”œâ”€â”€ App Service Plan
â”‚   â”œâ”€â”€ App Service (Frontend)
â”‚   â”œâ”€â”€ App Service (API)
â”‚   â”œâ”€â”€ Azure OpenAI / AI Services
â”‚   â”œâ”€â”€ Microsoft Foundry Project
â”‚   â”œâ”€â”€ Application Insights
â”‚   â””â”€â”€ Key Vault
â””â”€â”€ deploy
    â”œâ”€â”€ Frontend (App Service)
    â””â”€â”€ API (App Service)
```

---

## å¤–éƒ¨ä¾å­˜

| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” | å¿…é ˆ |
|----------|------|------|
| **Microsoft Fabric** | F4 Capacity ä»¥ä¸Š | âœ… å¿…é ˆ |
| **Azure OpenAI** | gpt-5 / gpt-4o-mini | âœ… å¿…é ˆ |
| **Azure AI Search** | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ (Foundry IQ) | âœ… å¿…é ˆ |
| **Bing Search (Grounding)** | Webæ¤œç´¢ | âœ… å¿…é ˆ |

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ã¯ `documents/` ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ä»¥ä¸‹ã‚’å‚ç…§:

- [TechnicalArchitecture.md](./documents/TechnicalArchitecture.md) - æŠ€è¡“è©³ç´°
- [DeploymentGuide.md](./documents/DeploymentGuide.md) - ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰
- [LocalDevelopmentSetup.md](./documents/LocalDevelopmentSetup.md) - ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
- [GitHubActionsSetup.md](./documents/GitHubActionsSetup.md) - CI/CD è¨­å®š
