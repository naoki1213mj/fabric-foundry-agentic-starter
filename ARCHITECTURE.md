# ARCHITECTURE.md - æŠ€è¡“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

> **æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ8æ—¥ - å“è³ªç›£æŸ»å®Œäº†ã‚’åæ˜ ã—ã¦æ›´æ–°

## Azure å®Ÿæ©Ÿç’°å¢ƒã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | ãƒªã‚½ãƒ¼ã‚¹å | å€¤ï¼ˆå®Ÿæ©Ÿç¢ºèª 2026/2/5ï¼‰ |
| -------- | ---------- | -------------- |
| **Resource Group** | - | `<your-resource-group>` |
| **App Service (API)** | `api-<your-suffix>` | Linux Container @ East US |
| **App Service (Frontend)** | `app-<your-suffix>` | Linux Container @ East US |
| **Container Registry** | `<your-acr-name>.azurecr.io` | Premium @ East US |
| **Azure AI Services** | `aisa-<your-suffix>` | AIServices @ East US |
| **AI Foundry Project** | `aifp-<your-suffix>` | East US |
| **Azure AI Search** | `<your-ai-search-name>` | Standard @ Australia East |
| **API Management** | `apim-<your-suffix>` | Consumption @ Australia East |
| **API Center** | `apic-<your-suffix>` | Free @ Australia East |
| **MCP Server** | `func-mcp-<your-suffix>` | Azure Functions Python 3.12 |
| **LLM Model** | gpt-5 | 500K TPM |
| **LLM Model (Mini)** | gpt-4o-mini | 30K TPM |
| **Embedding** | text-embedding-3-large | 500K TPM |
| **Bing Connection** | `<your-bing-connection-name>` | Web Search |

---

## å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    CLIENT LAYER                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Azure App Service (app-<your-suffix>)                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ React + TypeScript Frontend                                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Natural Language Query Interface                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Agent Mode Selector (sql_only / multi_tool / handoff / magentic)                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ Doc Search Reasoning Effort (minimal / low / medium)                             â”‚   â”‚
â”‚  â”‚  â””â”€ Built-in Auth (Entra ID EasyAuth)                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    API LAYER                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Azure App Service (api-<your-suffix>) - Python FastAPI                                â”‚ â”‚
â”‚  â”‚  â”œâ”€ /api/chat - Main chat endpoint (streaming SSE)                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ /api/conversations - Conversation history                                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ /health - Health check                                                            â”‚  â”‚
â”‚  â”‚  â””â”€ Agent Orchestration (Microsoft Agent Framework)                                  â”‚   â”‚
â”‚  â”‚      â”œâ”€ sql_only mode   â†’ AzureOpenAIResponsesClient + SQL Tool                      â”‚   â”‚
â”‚  â”‚      â”œâ”€ multi_tool mode â†’ AzureOpenAIResponsesClient + All Tools                     â”‚   â”‚
â”‚  â”‚      â”œâ”€ handoff mode    â†’ AzureOpenAIChatClient + HandoffBuilder                     â”‚   â”‚
â”‚  â”‚      â””â”€ magentic mode   â†’ AzureOpenAIChatClient + MagenticBuilder                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              INTEGRATION LAYER (AI Gateway)                                 â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  API Management                 â”‚  â”‚  API Center                     â”‚                   â”‚
â”‚  â”‚  (apim-<your-suffix>)            â”‚  â”‚  (apic-<your-suffix>)            â”‚                 â”‚
â”‚  â”‚  Consumption SKU                â”‚  â”‚  Free SKU                       â”‚                   â”‚
â”‚  â”‚                                 â”‚  â”‚                                 â”‚                   â”‚
â”‚  â”‚  APIs:                          â”‚  â”‚  Tool Catalog:                  â”‚                   â”‚
â”‚  â”‚  â”œâ”€ /openai                     â”‚  â”‚  â”œâ”€ Business Analytics MCP     â”‚                    â”‚
â”‚  â”‚  â”‚   â†’ Azure OpenAI (legacy)    â”‚  â”‚  â”‚   (16 tools / 4 categories) â”‚                    â”‚
â”‚  â”‚  â”œâ”€ /foundry-openai/openai/v1/  â”‚  â”‚  â”‚   å£²ä¸Š5/é¡§å®¢4/åœ¨åº«3/è£½å“4   â”‚                    â”‚
â”‚  â”‚  â”‚   â†’ Foundry AI Services â˜…    â”‚  â”‚  â”‚                             â”‚                    â”‚
â”‚  â”‚  â”œâ”€ /mcp                        â”‚  â”‚  â”‚                             â”‚                    â”‚
â”‚  â”‚  â”‚   â†’ MCP Server               â”‚  â”‚  â””â”€ Azure OpenAI API           â”‚                    â”‚
â”‚  â”‚  â””â”€ /foundry-agents             â”‚  â”‚  â””â”€ Azure OpenAI API           â”‚                    â”‚
â”‚  â”‚      â†’ Foundry Agent Service    â”‚  â”‚                                 â”‚                   â”‚
â”‚  â”‚                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”‚  Features:                      â”‚                                                        â”‚
â”‚  â”‚  â”œâ”€ Circuit Breaker (30s)       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  â”œâ”€ Token Metrics Headers       â”‚  â”‚  MCP Server                     â”‚                   â”‚
â”‚  â”‚  â”œâ”€ Managed Identity Auth       â”‚  â”‚  (func-mcp-<your-suffix>)        â”‚                  â”‚
â”‚  â”‚  â””â”€ Latency Measurement         â”‚  â”‚  Azure Functions Python 3.12   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                 â”‚                   â”‚
â”‚                                       â”‚  Endpoints:                     â”‚                   â”‚
â”‚                                       â”‚  â”œâ”€ /api/mcp (JSON-RPC 2.0)    â”‚                    â”‚
â”‚                                       â”‚  â””â”€ /api/tools/{tool_name}     â”‚                    â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    AI LAYER                                                 â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Microsoft Foundry (aisa-<your-suffix> / aifp-<your-suffix>)                         â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  Azure OpenAI       â”‚  â”‚  Foundry Guardrails â”‚  â”‚  Foundry IQ (Agentic RAG)   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Models:            â”‚  â”‚  â”œâ”€ Task Adherence  â”‚  â”‚  Knowledge Base:            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ gpt-5 (500K)    â”‚  â”‚  â”œâ”€ Prompt Shields  â”‚  â”‚  â””â”€ product-specs-kb        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ gpt-4o-mini     â”‚  â”‚  â”œâ”€ Spotlighting    â”‚  â”‚                             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   (30K)          â”‚  â”‚  â””â”€ Groundedness    â”‚  â”‚  Reasoning Effort:          â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ text-embedding  â”‚  â”‚      Detection      â”‚  â”‚  â”œâ”€ minimal (ç›´æ¥æ¤œç´¢)      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚      -3-large       â”‚  â”‚                     â”‚  â”‚  â”œâ”€ low (ã‚·ãƒ³ã‚°ãƒ«ãƒ‘ã‚¹)      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚      (500K)         â”‚  â”‚                     â”‚  â”‚  â””â”€ medium (åå¾©æ¤œç´¢)       â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  Bing Grounding     â”‚  â”‚  Project Connections                                â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                                                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Connection:        â”‚  â”‚  â”œâ”€ <your-bing-connection-name> (Bing Search)        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  <your-bing-conn>   â”‚  â”‚  â”œâ”€ AI Search Connection                            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚  â””â”€ Fabric SQL Connection                           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Tool Pattern:      â”‚  â”‚                                                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  BingGroundingAgent â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚  â”‚  Tool               â”‚                                                            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Azure AI Search (<your-ai-search-name>) - Standard SKU                             â”‚    â”‚
â”‚  â”‚  â”œâ”€ Index: product-specs-sharepoint-ks-index                                        â”‚    â”‚
â”‚  â”‚  â””â”€ API Version: 2025-11-01-preview                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    DATA LAYER                                               â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Microsoft Fabric (<your-fabric-capacity>) - F4 Capacity                            â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  SQL Database in Fabric                                                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  <your-fabric-sql-database>                                                â”‚    â”‚     â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Business Data Tables:          History Tables:                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ customers                   â”œâ”€ hst_conversations                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ products                    â””â”€ hst_conversation_messages                â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ orders                                                                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ order_items                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ inventory                                                               â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  OneLake (Medallion Architecture)                                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ Bronze: Raw Data                                                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ Silver: Validated/Cleansed                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ Gold: Business-Ready                                                    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ„ãƒ¼ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AGENT TOOLS ARCHITECTURE                                       â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Agent Framework Tool Registry                                                      â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  @tool decorated tools:                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     â”‚
â”‚  â”‚  â”‚  SQL Tool           â”‚  â”‚  Doc Tool           â”‚  â”‚  Web Tool           â”‚         â”‚     â”‚
â”‚  â”‚  â”‚  sql_agent.py       â”‚  â”‚  agentic_retrieval  â”‚  â”‚  web_agent.py       â”‚         â”‚     â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚  _tool.py           â”‚  â”‚                     â”‚         â”‚     â”‚
â”‚  â”‚  â”‚  execute_sql_query  â”‚  â”‚                     â”‚  â”‚  search_web         â”‚         â”‚     â”‚
â”‚  â”‚  â”‚  ()                 â”‚  â”‚  search_documents() â”‚  â”‚  ()                 â”‚         â”‚     â”‚
â”‚  â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚         â”‚     â”‚
â”‚  â”‚  â”‚  Backend:           â”‚  â”‚  Backend:           â”‚  â”‚  Backend:           â”‚         â”‚     â”‚
â”‚  â”‚  â”‚  Fabric SQL DB      â”‚  â”‚  Foundry IQ         â”‚  â”‚  Bing Grounding     â”‚         â”‚     â”‚
â”‚  â”‚  â”‚  (pyodbc)           â”‚  â”‚  (Agentic RAG)      â”‚  â”‚  AgentTool          â”‚         â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  MCP Tools (via APIM Gateway) - 16 Business Analytics Tools:                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  MCP Server (func-mcp-<your-suffix>)                                         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  å£²ä¸Šåˆ†æ (5):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_yoy_growth()          - å‰å¹´åŒæœŸæ¯”æˆé•·ç‡                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_mom_growth()          - å‰æœˆæ¯”æˆé•·ç‡                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_moving_average()      - ç§»å‹•å¹³å‡                             â”‚    â”‚     â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_abc_analysis()        - ABCåˆ†æï¼ˆãƒ‘ãƒ¬ãƒ¼ãƒˆï¼‰                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ calculate_sales_forecast()      - å£²ä¸Šäºˆæ¸¬                             â”‚    â”‚     â”‚
â”‚  â”‚  â”‚  é¡§å®¢åˆ†æ (4):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_rfm_score()           - RFMã‚¹ã‚³ã‚¢è¨ˆç®—                         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ classify_customer_segment()     - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†é¡                        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_clv()                 - é¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ recommend_next_action()         - Next Best Action                     â”‚    â”‚     â”‚
â”‚  â”‚  â”‚  åœ¨åº«åˆ†æ (3):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_inventory_turnover()  - åœ¨åº«å›è»¢ç‡                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_reorder_point()       - ç™ºæ³¨ç‚¹ç®—å‡º                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ identify_slow_moving_inventory()- æ»ç•™åœ¨åº«ç‰¹å®š                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  è£½å“æ¯”è¼ƒ (4):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ compare_products()              - è£½å“æ¯”è¼ƒ                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_price_performance()   - ä¾¡æ ¼æ€§èƒ½æ¯”                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ suggest_alternatives()          - ä»£æ›¿è£½å“ææ¡ˆ                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ calculate_bundle_discount()     - ãƒãƒ³ãƒ‰ãƒ«å‰²å¼•                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Protocol: JSON-RPC 2.0 over HTTP                                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Endpoint: https://apim-*/mcp â†’ https://func-mcp-*/api/mcp                  â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Mermaid å›³

```mermaid
graph TB
    subgraph Client["ğŸ–¥ï¸ Client Layer"]
        WEB["App Service<br/>app-<your-suffix><br/>React Frontend"]
    end

    subgraph API["âš™ï¸ API Layer"]
        ACA["App Service<br/>api-<your-suffix><br/>Python FastAPI"]
        MAF["Microsoft Agent Framework<br/>ResponsesClient / ChatClient"]
    end

    subgraph Integration["ğŸ”Œ Integration Layer"]
        APIM["API Management<br/>apim-<your-suffix><br/>AI Gateway"]
        APIC["API Center<br/>apic-<your-suffix><br/>Tool Catalog"]
        MCP["MCP Server<br/>func-mcp-<your-suffix><br/>Business Analytics"]
    end

    subgraph AI["ğŸ¤– AI Layer"]
        FAS["Foundry Project<br/>aifp-<your-suffix>"]
        OAI["Azure OpenAI<br/>gpt-5 / gpt-4o-mini"]
        FIQ["Foundry IQ<br/>Agentic Retrieval"]
        BING["Bing Grounding<br/><your-bing-connection-name>"]
        FG["Foundry Guardrails"]
        SEARCH["Azure AI Search<br/>search-sp-rag-*"]
    end

    subgraph Data["ğŸ’¾ Data Layer"]
        FABRIC["Microsoft Fabric<br/>F4 Capacity"]
        SQLDB["SQL Database in Fabric<br/>retail_sqldatabase_*"]
        ONELAKE["OneLake<br/>Medallion Architecture"]
    end

    WEB -->|HTTPS| ACA
    ACA --> MAF
    MAF -->|/foundry-openai| APIM
    APIM --> OAI
    MAF --> FAS
    FAS --> FG
    FAS --> OAI
    MAF -->|SQL Query| SQLDB
    MAF -->|Agentic RAG| FIQ
    FIQ --> SEARCH
    MAF -->|Web Search| BING
    MAF -->|/mcp| APIM
    APIM --> MCP
    APIC -.->|Discovery| MCP
    SQLDB --> ONELAKE
    ONELAKE --> FABRIC
```

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AGENT MODES ARCHITECTURE                                       â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Mode Selection (Frontend â†’ /api/chat?agent_mode=xxx)                                â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚  sql_only       â”‚  â”‚  multi_tool â˜…   â”‚  â”‚  handoff        â”‚  â”‚  magentic       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  âš¡ æœ€é€Ÿ        â”‚  â”‚  ğŸ”¥ æ¨å¥¨        â”‚  â”‚  æ™®é€š           â”‚  â”‚  é…ã„           â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  SQLå°‚ç”¨        â”‚  â”‚  å…¨ãƒ„ãƒ¼ãƒ«       â”‚  â”‚  å°‚é–€å®¶å§”è­²     â”‚  â”‚  ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚  çµ±åˆ           â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  Client:        â”‚  â”‚  Client:        â”‚  â”‚  Client:        â”‚  â”‚  Client:        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  Responses âœ“    â”‚  â”‚  Responses âœ“    â”‚  â”‚  Chat (SDKåˆ¶ç´„) â”‚  â”‚  Chat (SDKåˆ¶ç´„) â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  Tools:         â”‚  â”‚  Tools:         â”‚  â”‚  Tools:         â”‚  â”‚  Tools:         â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ SQL         â”‚  â”‚  â”œâ”€ SQL         â”‚  â”‚  Specialists:   â”‚  â”‚  Specialists:   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â”œâ”€ Doc         â”‚  â”‚  â”œâ”€ SQL Agent   â”‚  â”‚  â”œâ”€ SQL Agent   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â”œâ”€ Web         â”‚  â”‚  â”œâ”€ Doc Agent   â”‚  â”‚  â”œâ”€ Doc Agent   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚  â””â”€ MCP(16)     â”‚  â”‚  â””â”€ Web Agent   â”‚  â”‚  â””â”€ Web Agent   â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  Note: handoff/magentic ã¯ HandoffBuilder/MagenticBuilder SDK ãŒ                     â”‚   â”‚
â”‚  â”‚        AzureOpenAIChatClient ã‚’è¦æ±‚ã™ã‚‹ãŸã‚ ChatClient ã‚’ç¶­æŒ                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¢ãƒ¼ãƒ‰é¸æŠã‚¬ã‚¤ãƒ‰

| ãƒ¢ãƒ¼ãƒ‰ | Client | é€Ÿåº¦ | ç”¨é€” | ç‰¹å¾´ |
|--------|--------|------|------|------|
| `sql_only` | ResponsesClient | âš¡æœ€é€Ÿ | å˜ç´”ãªSQLã‚¯ã‚¨ãƒª | SQLãƒ„ãƒ¼ãƒ«ã®ã¿ |
| `multi_tool` | ResponsesClient | ğŸ”¥é«˜é€Ÿ | **æ¨å¥¨** - æ±ç”¨ | LLMãŒæœ€é©ãƒ„ãƒ¼ãƒ«é¸æŠ |
| `handoff` | ChatClient | æ™®é€š | å°‚é–€å®¶å§”è­² | çµæœã¯çµ±åˆã•ã‚Œãªã„ |
| `magentic` | ChatClient | é…ã„ | è¤‡é›‘ãªåˆ†æ | ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒçµæœçµ±åˆ |

---

## API Management (AI Gateway) è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API MANAGEMENT CONFIGURATION                                   â”‚
â”‚                              apim-<your-suffix> (Consumption SKU)                           â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Registered APIs                                                                     â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  /openai (Legacy)                                                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Backend: https://aisa-<your-suffix>.openai.azure.com                        â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  /foundry-openai/openai/v1/ â˜… Primary                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Backend: https://aisa-<your-suffix>.services.ai.azure.com                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  â†’ Used by AzureOpenAIResponsesClient                                       â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  /mcp                                                                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Backend: https://func-mcp-<your-suffix>.azurewebsites.net                   â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  /foundry-agents                                                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  Backend: Foundry Agent Service                                             â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  AI Gateway Features                                                                 â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ Circuit Breaker: 429/500-599 errors â†’ 30s trip duration                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ Token Metrics: x-openai-{prompt,completion,total}-tokens headers                â”‚    â”‚
â”‚  â”‚  â”œâ”€ Latency: x-gateway-latency-ms header                                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ Authentication: Managed Identity (DefaultAzureCredential)                       â”‚    â”‚
â”‚  â”‚  â””â”€ Note: llm-emit-token-metric not supported on Consumption SKU                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Management ãƒãƒªã‚·ãƒ¼è¨­å®šè©³ç´°

#### 1. Inbound ãƒãƒªã‚·ãƒ¼

```xml
<inbound>
    <!-- Managed Identity èªè¨¼ -->
    <authentication-managed-identity resource="https://cognitiveservices.azure.com" />
    
    <!-- CORS è¨­å®š -->
    <cors allow-credentials="true">
        <allowed-origins>
            <origin>https://app-<your-suffix>.azurewebsites.net</origin>
        </allowed-origins>
        <allowed-methods><method>*</method></allowed-methods>
        <allowed-headers><header>*</header></allowed-headers>
    </cors>
    
    <!-- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ (Consumption SKU ã§ã¯åˆ¶é™ã‚ã‚Š) -->
    <rate-limit-by-key calls="100" renewal-period="60" 
                       counter-key="@(context.Subscription.Id)" />
</inbound>
```

#### 2. Backend ãƒãƒªã‚·ãƒ¼

```xml
<backend>
    <!-- Circuit Breaker è¨­å®š -->
    <circuit-breaker>
        <rule name="openai-circuit-breaker" 
              trip-duration="30"
              accept-retry-after="true">
            <failure-condition>
                <status-code-range min="429" max="429"/>
                <status-code-range min="500" max="599"/>
            </failure-condition>
        </rule>
    </circuit-breaker>
    
    <!-- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š -->
    <forward-request timeout="120" />
</backend>
```

#### 3. Outbound ãƒãƒªã‚·ãƒ¼

```xml
<outbound>
    <!-- ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ  -->
    <set-header name="x-openai-prompt-tokens" exists-action="override">
        <value>@(context.Response.Body?.As<JObject>()?["usage"]?["prompt_tokens"]?.ToString() ?? "0")</value>
    </set-header>
    <set-header name="x-openai-completion-tokens" exists-action="override">
        <value>@(context.Response.Body?.As<JObject>()?["usage"]?["completion_tokens"]?.ToString() ?? "0")</value>
    </set-header>
    <set-header name="x-openai-total-tokens" exists-action="override">
        <value>@(context.Response.Body?.As<JObject>()?["usage"]?["total_tokens"]?.ToString() ?? "0")</value>
    </set-header>
    
    <!-- ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·è¨ˆæ¸¬ -->
    <set-header name="x-gateway-latency-ms" exists-action="override">
        <value>@(context.Elapsed.TotalMilliseconds.ToString("0"))</value>
    </set-header>
</outbound>
```

### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°

| API | ãƒ‘ã‚¹ | ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | èªè¨¼ | ç”¨é€” |
|-----|------|----------|--------------|------|------|
| **Azure OpenAI (Legacy)** | `/openai/deployments/{deployment}/chat/completions` | POST | `aisa-*.openai.azure.com` | Managed Identity | æ—§å½¢å¼ã® Chat Completions |
| **Foundry OpenAI** | `/foundry-openai/openai/v1/chat/completions` | POST | `aisa-*.services.ai.azure.com` | Managed Identity | **ResponsesClient æ¨å¥¨** |
| **Foundry OpenAI** | `/foundry-openai/openai/v1/responses` | POST | `aisa-*.services.ai.azure.com` | Managed Identity | Responses API |
| **MCP Server** | `/mcp` | POST | `func-mcp-*.azurewebsites.net/api/mcp` | API Key | JSON-RPC 2.0 |
| **Foundry Agents** | `/foundry-agents/threads/{thread_id}/messages` | POST | Foundry Agent Service | Managed Identity | Agent Thread ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |

---

## API Center (ãƒ„ãƒ¼ãƒ«ã‚«ã‚¿ãƒ­ã‚°) è©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API CENTER CONFIGURATION                                       â”‚
â”‚                              apic-<your-suffix> (Free SKU)                                  â”‚
â”‚                                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç›®çš„: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ API/ãƒ„ãƒ¼ãƒ«ã®ã‚«ã‚¿ãƒ­ã‚°ç®¡ç†ãƒ»ç™ºè¦‹ãƒ»ã‚¬ãƒãƒŠãƒ³ã‚¹                       â”‚   â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  ç™»éŒ²æ¸ˆã¿ API                                                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  1. Business Analytics MCP Server                                          â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â”œâ”€ Type: MCP Server (JSON-RPC 2.0)                                     â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â”œâ”€ Version: 1.0.0                                                      â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â”œâ”€ Lifecycle: Production                                               â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â”œâ”€ Endpoint: https://apim-*/mcp                                        â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â””â”€ Tools: 16 (4ã‚«ãƒ†ã‚´ãƒª: å£²ä¸Š5, é¡§å®¢4, åœ¨åº«3, è£½å“4)              â”‚    â”‚          â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  2. Azure OpenAI API                                                       â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â”œâ”€ Type: REST API (OpenAPI 3.0)                                        â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â”œâ”€ Version: 2024-02-15-preview                                         â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â”œâ”€ Lifecycle: Production                                               â”‚    â”‚     â”‚
â”‚  â”‚  â”‚     â””â”€ Endpoint: https://apim-*/foundry-openai/openai/v1/                  â”‚    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  MCP Server ãƒ„ãƒ¼ãƒ«ä¸€è¦§ (16ãƒ„ãƒ¼ãƒ« / 4ã‚«ãƒ†ã‚´ãƒª)                        â”‚    â”‚           â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  å£²ä¸Šåˆ†æ (5):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_yoy_growth         - å‰å¹´åŒæœŸæ¯”æˆé•·ç‡                         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_mom_growth         - å‰æœˆæ¯”æˆé•·ç‡                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_moving_average     - ç§»å‹•å¹³å‡                                â”‚    â”‚     â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_abc_analysis       - ABCåˆ†æï¼ˆãƒ‘ãƒ¬ãƒ¼ãƒˆï¼‰                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ calculate_sales_forecast     - å£²ä¸Šäºˆæ¸¬                                â”‚    â”‚     â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  é¡§å®¢åˆ†æ (4):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_rfm_score          - RFMã‚¹ã‚³ã‚¢è¨ˆç®—                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ classify_customer_segment    - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†é¡                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_clv               - é¡§å®¢ç”Ÿæ¶¯ä¾¡å€¤                             â”‚    â”‚     â”‚
â”‚  â”‚  â”‚  â””â”€ recommend_next_action        - Next Best Action                        â”‚    â”‚     â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  åœ¨åº«åˆ†æ (3):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_inventory_turnover - åœ¨åº«å›è»¢ç‡                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_reorder_point      - ç™ºæ³¨ç‚¹ç®—å‡º                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ identify_slow_moving_inventory - æ»ç•™åœ¨åº«ç‰¹å®š                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  è£½å“æ¯”è¼ƒ (4):                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ compare_products             - è£½å“æ¯”è¼ƒ                                â”‚    â”‚     â”‚
â”‚  â”‚  â”‚  â”œâ”€ calculate_price_performance  - ä¾¡æ ¼æ€§èƒ½æ¯”                               â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ suggest_alternatives         - ä»£æ›¿è£½å“ææ¡ˆ                             â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ calculate_bundle_discount    - ãƒãƒ³ãƒ‰ãƒ«å‰²å¼•                             â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Center ã®å½¹å‰²

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| **API Discovery** | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ã‚’ç™ºè¦‹ãƒ»æ¤œç´¢ |
| **Version Management** | API/ãƒ„ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«è¿½è·¡ |
| **Schema Registry** | OpenAPI/JSON Schema ã®ä¸€å…ƒç®¡ç† |
| **Governance** | API ã®å‘½åè¦å‰‡ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ |
| **Analytics** | API åˆ©ç”¨çŠ¶æ³ã®å¯è¦–åŒ–ï¼ˆå°†æ¥æ‹¡å¼µï¼‰ |

### API Center ã¨ APIM ã®é€£æº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent Framework ã‹ã‚‰ã® Tool å‘¼ã³å‡ºã—ãƒ•ãƒ­ãƒ¼                                      â”‚
â”‚                                                                                  â”‚
â”‚  1. åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚º                                                               â”‚
â”‚     â”œâ”€ API Center ã‹ã‚‰åˆ©ç”¨å¯èƒ½ãª MCP Tools ã®ä¸€è¦§ã‚’å–å¾—                          â”‚
â”‚     â””â”€ Tool å®šç¾© (åå‰ã€èª¬æ˜ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿) ã‚’ Agent ã«ç™»éŒ²                        â”‚
â”‚                                                                                  â”‚
â”‚  2. å®Ÿè¡Œãƒ•ã‚§ãƒ¼ã‚º                                                                 â”‚
â”‚     â”œâ”€ LLM ãŒæœ€é©ãª Tool ã‚’é¸æŠ                                                  â”‚
â”‚     â”œâ”€ Agent Framework ãŒ JSON-RPC ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ§‹ç¯‰                              â”‚
â”‚     â”œâ”€ APIM Gateway çµŒç”±ã§ MCP Server ã«é€ä¿¡                                     â”‚
â”‚     â”‚   â””â”€ POST https://apim-*/mcp                                               â”‚
â”‚     â”‚       Content-Type: application/json                                       â”‚
â”‚     â”‚       Body: {"jsonrpc":"2.0","method":"tools/call",...}                    â”‚
â”‚     â””â”€ MCP Server ãŒãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—çµæœã‚’è¿”å´                                     â”‚
â”‚                                                                                  â”‚
â”‚  3. ç›£è¦–ãƒ•ã‚§ãƒ¼ã‚º                                                                 â”‚
â”‚     â”œâ”€ APIM: ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã€ã‚¨ãƒ©ãƒ¼ç‡ã€ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ                                  â”‚
â”‚     â”œâ”€ Application Insights: åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°                                    â”‚
â”‚     â””â”€ API Center: åˆ©ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆï¼ˆå°†æ¥ï¼‰                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

```
src/api/python/prompts/
â”œâ”€â”€ __init__.py          # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ sql_agent.py         # SQL_AGENT_PROMPT
â”œâ”€â”€ web_agent.py         # WEB_AGENT_PROMPT
â”œâ”€â”€ doc_agent.py         # DOC_AGENT_PROMPT
â”œâ”€â”€ manager_agent.py     # MANAGER_AGENT_PROMPT
â”œâ”€â”€ unified_agent.py     # UNIFIED_AGENT_PROMPT
â””â”€â”€ triage_agent.py      # TRIAGE_AGENT_PROMPT
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤æ§‹æˆ

### GitHub Actionsï¼ˆç¾åœ¨ã®æ–¹å¼ï¼‰

```
git push â†’ GitHub Actions â†’ Docker Build â†’ ACR Push â†’ App Service Restart
```

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒˆãƒªã‚¬ãƒ¼ |
|---------------|---------|
| Frontend | `src/App/**` å¤‰æ›´æ™‚ |
| API | `src/api/python/**` å¤‰æ›´æ™‚ |
| Agents | `infra/scripts/agent_scripts/agents/**` å¤‰æ›´æ™‚ |

### azd upï¼ˆåˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”¨ï¼‰

```bash
azd up
â”œâ”€â”€ provision (Bicep)
â”‚   â”œâ”€â”€ Resource Group
â”‚   â”œâ”€â”€ Container Registry
â”‚   â”œâ”€â”€ App Service Plan
â”‚   â”œâ”€â”€ App Service (Frontend)
â”‚   â”œâ”€â”€ App Service (API)
â”‚   â”œâ”€â”€ Azure OpenAI / AI Services
â”‚   â”œâ”€â”€ Microsoft Foundry Project
â”‚   â”œâ”€â”€ Application Insights
â”‚   â””â”€â”€ Key Vault
â””â”€â”€ deploy
    â”œâ”€â”€ Frontend (App Service)
    â””â”€â”€ API (App Service)
```

---

## å¤–éƒ¨ä¾å­˜

| ã‚µãƒ¼ãƒ“ã‚¹ | ç”¨é€” | å¿…é ˆ |
|----------|------|------|
| **Microsoft Fabric** | F4 Capacity ä»¥ä¸Š | âœ… å¿…é ˆ |
| **Azure OpenAI** | gpt-5 / gpt-4o-mini | âœ… å¿…é ˆ |
| **Azure AI Search** | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¤œç´¢ (Foundry IQ) | âœ… å¿…é ˆ |
| **Bing Search (Grounding)** | Webæ¤œç´¢ | âœ… å¿…é ˆ |

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ã¯ `documents/` ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ä»¥ä¸‹ã‚’å‚ç…§:

- [TechnicalArchitecture.md](./documents/TechnicalArchitecture.md) - æŠ€è¡“è©³ç´°
- [DeploymentGuide.md](./documents/DeploymentGuide.md) - ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰
- [LocalDevelopmentSetup.md](./documents/LocalDevelopmentSetup.md) - ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
- [GitHubActionsSetup.md](./documents/GitHubActionsSetup.md) - CI/CD è¨­å®š
