# # yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json
# metadata:
#     template: azd-init@1.11.1
environment:
  name: agentic-applications-for-unified-data-foundation
  location: eastus
name: agentic-applications-for-unified-data-foundation

requiredVersions:
  azd: ">= 1.15.0"

metadata:
  template: agentic-applications-for-unified-data-foundation@1.0

hooks:
  postprovision:
    windows:
      run: |
        Write-Host "Web app URL: " -ForegroundColor Green
        Write-Host "$env:WEB_APP_URL" -ForegroundColor Cyan
        Write-Host ""

        # Auto-update agents
        Write-Host "Updating Microsoft Foundry agents..." -ForegroundColor Yellow
        & ./infra/scripts/agent_scripts/update_agents.ps1

        Write-Host ""
        Write-Host "For Fabric setup, run:" -ForegroundColor Yellow
        Write-Host "bash ./infra/scripts/fabric_scripts/run_fabric_items_scripts.sh <fabric_workspace_id>" -ForegroundColor Cyan

      shell: pwsh
      continueOnError: false
      interactive: true
    posix:
      run: |
        echo "Web app URL: $WEB_APP_URL"
        echo ""

        # Auto-update agents
        echo "Updating Microsoft Foundry agents..."
        bash ./infra/scripts/agent_scripts/update_agents.sh

        echo ""
        echo "For Fabric setup, run:"
        echo "bash ./infra/scripts/fabric_scripts/run_fabric_items_scripts.sh <fabric_workspace_id>"

      shell: sh
      continueOnError: false
      interactive: true

  # Post-deploy hook - also update agents after app deployment
  postdeploy:
    windows:
      run: |
        Write-Host "Ensuring agents are up to date..." -ForegroundColor Yellow
        & ./infra/scripts/agent_scripts/update_agents.ps1
      shell: pwsh
      continueOnError: true
    posix:
      run: |
        echo "Ensuring agents are up to date..."
        bash ./infra/scripts/agent_scripts/update_agents.sh
      shell: sh
      continueOnError: true
